\subsection{Create a new group}\label{sec:implAppNewGroup}
\fig{New group creation flow chart}{appNewGroup}{1.0}{flowCharts/appNewGroup}

As point \ref{req:createGroups} states in the requirement specification (appendix \ref{appendix:requirements}) a functionality of the application is to create new groups.
When a new group is being created a set of machines should be selectable and different \acrshort{rssi} values mapped to it.
\Cref{fig:appNewGroup} show the flow chart of the creation for a new group.


\subsubsection{Get machines}\label{sec:implAppNewGroupGetMachines}
To be able to choose machines for a new group they first need to be fetched from a Azure Cosmos database container \cite{IntroductionAzureCosmos}.
The server is taking care of the database handling, which means the application will get the machines from the server with a HTTPs GET request \cite{GETHTTPMDN}.
The API endpoint that is being called is \textit{.../api/machines/all}.
In the application these request is handled with the iOS API \textit{ResourceUrl} \cite{ResourceURLAppleDeveloper}.

\bigskip

On a successful request all machines are loaded into the application.
These machines is then being presented to the user in a list.
The entries in the list is selectable via a touch action, where the selected machines is mapped to the group.
Since one machine can be used in multiple groups the machine ID's is stored in the group.


\subsubsection{Set group name}\label{sec:implAppNewGroupSetName}
For a group to be easier identifiable by a user a name is set for it.
In the application a text field is filled with the name and then being sent to the server with the rest of the data.


\subsubsection{Map position}\label{sec:implAppNewGroupMapPos}
A group is the part of the system that is being identified as a position in the undefined space and need position fingerprints tied to it.
Nearby \acrshort{ble} iBeacon signals is picked up in the application with the iOS API \textit{CoreLocation} \cite{CoreLocationApple}.

\bigskip

To be able to map a new position to the group a condition where at least three iBeacons are in range need to be fulfilled.
If this condition is not met a warning modal is being showed to the user and the data will not be collected.
When the condition is met the nearby iBeacons is collected and the data is being cleaned to only consist of the iBeacon \acrshort{rssi} and minor values.
\Cref{listing:beaconFingerprint} present an example how this collected, cleaned iBeacon data looks like.

\fileListing{Formatted iBeacon fingerprint}{beaconFingerprint}{json}{fingerprint.json}

This mapping is done manually and the collected data is being inserted into an array which looks like \cref{listing:groupFingerprints}.

\fileListing{A set of collected fingerprints for a group}{groupFingerprints}{json}{groupFingerprints.json}

\subsubsection{Send data to server}\label{sec:implAppnewGroupSend}
When a name is set, machines selected and iBeacons data mapped the group is ready and can be sent to the server as a \acrfull{json} object \cite{IntroducingJSON}.
This is done against the server API endpoint \textit{.../api/group/create} with a HTTPs POST request \cite{POSTHTTPMDN}, where the iOS API \textit{ResourceUrl} \cite{ResourceURLAppleDeveloper} takes care of the request in the application.
Appendix \ref{appendix:newGroupData} presents an example on a full data example of a new group.
